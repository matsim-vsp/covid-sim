import{P as r}from"./papaparse.min-CFe1x9DG.js";import{V as h}from"./VuePlotly-3ptdy97-.js";import{Z as p}from"./zip-loader.module-BRLILkva.js";import{h as m}from"./moment-C5S46NFB.js";import{V as f}from"./vue-slide-bar.min-C15Y2jWu.js";import{d as c,n as l,M as g}from"./index-B5glX0dC.js";import{b as y}from"./berlin-cases-BQxiAdRu.js";const v=c({name:"SelectWidget",components:{VueSlideBar:f},props:{state:{type:Object,required:!0},measure:{type:String,required:!0}},data(){return{value:0,stops:[0,1e3],showButtons:!1,showSlider:!0,interventions:{remainingFractionKiga:"Going to kindergarten",remainingFractionPrimary:"Going to primary school",remainingFractionSecondary:"Going to secondary/univ.",remainingFractionWork:"Work activities",remainingFractionLeisure:"Leisure activities",remainingFractionShoppingErrandsBusiness:"All other activities"}}},mounted(){const s=[];for(const t of this.state.measures[this.measure]){let e=t;t===.2&&(e="20%"),t===.4&&(e="40%"),t===.6&&(e="60%"),t===.8&&(e="80%"),isNaN(e)&&(this.showButtons||(this.value=e),this.showButtons=!0,this.showSlider=!1),s.push(e)}this.stops=s.map(t=>t<=1?t*100:t),this.showSlider&&(this.value="Never")},computed:{measureTitle(){return this.interventions[this.measure]}},watch:{value(){let s=this.value;s==="Never"?s=1e3:s==="20%"?s=.2:s==="40%"?s=.4:s==="60%"?s=.6:s==="80%"?s=.8:isNaN(s)||(s=.01*s),console.log(s),this.$emit("changed",this.measure,s)}},methods:{choseButton(s){console.log(s),this.value=s}}});var b=function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",{staticClass:"zslect-widget"},[t.showSlider?e("vue-slide-bar",{staticClass:"my-slider",attrs:{speed:0,data:t.stops},model:{value:t.value,callback:function(a){t.value=a},expression:"value"}}):t._e(),t.showButtons?e("div",{staticClass:"button-choices"},t._l(t.stops,function(a){return e("button",{key:a,staticClass:"button is-small",class:{"is-link":a===t.value},on:{click:function(i){return t.choseButton(a)}}},[t._v(t._s(a))])}),0):t._e(),e("p",[t._v(t._s(t.measureTitle))])],1)},C=[],_=l(v,b,C,!1,null,"77720be9");const S=_.exports,k=c({name:"ChartSelector",components:{MySlider:S,VuePlotly:h},props:{state:{type:Object,required:!0},city:{type:String,required:!0}},data(){return{MAX_DAYS:200,plusminus:"-5",isBase:!1,data:[],layout:{autosize:!0,legend:{orientation:"h"},font:{family:"Roboto,Arial,Helvetica,sans-serif",size:12,color:"#000"},margin:{l:50,t:10,r:10,b:0},yaxis:{title:"Population",autorange:!0},xaxis:{range:["2020-02-16","2020-08-31"],type:"date"},plot_bgcolor:"#f8f8f8",paper_bgcolor:"#f8f8f8"},loglayout:{autosize:!0,showlegend:!0,legend:{orientation:"h"},font:{family:"Roboto,Arial,Helvetica,sans-serif",size:12,color:"#000"},margin:{t:5,r:10,b:0,l:60},xaxis:{range:["2020-02-16","2020-08-31"],type:"date"},yaxis:{type:"log",autorange:!0,title:"Population (log scale)"},plot_bgcolor:"#f8f8f8",paper_bgcolor:"#f8f8f8"},options:{displaylogo:!1,responsive:!0,modeBarButtonsToRemove:["pan2d","zoom2d","select2d","lasso2d","zoomIn2d","zoomOut2d","autoScale2d","hoverClosestCartesian","hoverCompareCartesian","resetScale2d","toggleSpikelines","resetViewMapbox"],toImageButtonOptions:{format:"svg",filename:"custom_image",width:800,height:600,scale:1}},currentSituation:{},currentRun:{},loadedSeriesData:{},zipLoader:{},zipCache:{},labels:{nSusceptible:"Susceptible",nInfectedButNotContagious:"Infected, not contagious",nContagious:"Contagious",nShowingSymptoms:"Showing Symptoms",nSeriouslySick:"Seriously Sick",nCritical:"Critical",nTotalInfected:"Total Infected",nInfectedCumulative:"Infected Cumulative",nRecovered:"Recovered",nInQuarantine:"In Quarantine"},fillcolors:{Susceptible:"#0000ff","Seriously Sick":"#cc2211","Showing Symptoms":"#00ffff","Infected Cumulative":"#f791cf","Infected, not contagious":"#ee8800",Critical:"#882299",Recovered:"#eedd44",Contagious:"#00aa00","Total Infected":"#a65628"}}},mounted(){this.loadZipData()},computed:{cityCap(){return this.city.slice(0,1).toUpperCase()+this.city.slice(1)},prettyInfected(){if(!this.state.cumulativeInfected)return"";const s=100*Math.round(this.state.cumulativeInfected*.01);return Number(s).toLocaleString()}},watch:{city(){this.loadedSeriesData={},this.loadZipData()},plusminus(){console.log("now we are",this.plusminus),this.showPlotForCurrentSituation()}},methods:{setBase(s){this.isBase=s,this.showPlotForCurrentSituation()},setPlusMinus(s){this.plusminus=s},async loadZipData(){if(this.zipCache[this.city])console.log("using cached zip for!",this.city),this.zipLoader=this.zipCache[this.city];else{const s=this.state.publicPath+"v6-data-"+this.city+".zip";this.zipLoader=new p(s),await this.zipLoader.load()}console.log("zip loaded!"),this.zipCache[this.city]=this.zipLoader,this.runChanged()},testErrors(){const s=[{x:[1,2,3],y:[1,1.1,1.2],name:"low"}],t=s[0].x.length;console.log({z:t});const e=[{x:[1,2,3,4],y:[3,4,5,6],name:"high"}];s[0].x.push(55),console.log({z:t});const a=this.generateErrorBars(s,e);console.log({answer:a})},generateErrorBars(s,t){console.log({low:s,high:t});for(let e=0;e<s.length;e++){const a=s[e].x.length,i=t[e].x.length;console.log({lowLen:a,highLen:i});let o=[];o=o.concat(s[e].x),o=o.concat(t[e].x.slice().reverse());let n=[];n=n.concat(s[e].y),n=n.concat(t[e].y.slice().reverse()),s[e].x=o,s[e].y=n;const u=this.fillcolors[s[e].name];s[e].fillcolor=u+"20",s[e].showlegend=!0,s[e].line={color:u},s[e].fill="tozerox",s[e].type="scatter"}return console.log({errorBar:s}),s},async runChanged(){if(this.loadedSeriesData[this.currentRun.RunId]){this.data=this.loadedSeriesData[this.currentRun.RunId],this.updateTotalInfected();return}const s=await this.loadCSV(this.currentRun),t=this.generateSeriesFromCSVData(s);this.loadedSeriesData[this.currentRun.RunId]=t,this.data=t,this.updateTotalInfected()},updateTotalInfected(){const s=this.data.filter(t=>t.name==="Infected Cumulative")[0];this.state.cumulativeInfected=Math.max(...s.y)},sliderChanged(s,t){console.log(s,t),this.currentSituation[s]=t,this.showPlotForCurrentSituation()},showPlotForCurrentSituation(){if(this.isBase){this.currentRun={RunId:"sz0"},this.runChanged();return}let s="";for(const a of Object.keys(this.state.measures))s+=this.currentSituation[a]+"-";const t=this.plusminus==="5"?"5":"-5",e=s.replace("undefined",t);console.log(e),this.currentRun=this.state.runLookup[e],this.currentRun&&this.runChanged()},unpack(s,t){let e=s.map(function(a){return a[t]});return e=e.slice(0,this.MAX_DAYS),e.length<this.MAX_DAYS&&e.push(t==="day"?this.MAX_DAYS:e[e.length-1]),e},async loadCSV(s){if(!s.RunId)return[];const t=s.RunId+".infections.txt";console.log("Extracting",t);let e=this.zipLoader.extractAsText(t);return r.parse(e,{header:!0,dynamicTyping:!0,skipEmptyLines:!0}).data},calculateDatefromSimulationDay(s){const t=this.plusminus==="-5"?"2020-02-22":"2020-02-12";return m(t).add(s,"days").format("YYYY-MM-DD")},generateSeriesFromCSVData(s){const t=[],e=this.unpack(s,"day");console.log({days:e});const a=e.map(i=>this.calculateDatefromSimulationDay(i));console.log({x:a});for(const i of Object.keys(this.labels)){const o=this.labels[i];if(o==="In Quarantine")continue;const n=this.unpack(s,i);t.push({x:a,y:n,name:o})}return this.city==="berlin"&&t.push(this.state.berlinCases),t}}});var w=function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",{staticClass:"charts"},[e("div",{staticClass:"preamble"},[e("h3",{staticClass:"select-scenario"},[t._v("Select Scenario:")]),e("div",{staticClass:"variation"},[e("b",[t._v("Variation")]),e("div",{staticClass:"variation-choices buttons has-addons"},[e("button",{staticClass:"button is-small",class:{"is-link":t.plusminus==="-5","is-selected":t.plusminus==="-5"},on:{click:function(a){return t.setPlusMinus("-5")}}},[t._v("-5")]),e("button",{staticClass:"button is-small",class:{"is-link":t.plusminus==="5","is-selected":t.plusminus==="5"},on:{click:function(a){return t.setPlusMinus("5")}}},[t._v("+5")])])])]),e("div",{attrs:{id:"main-section"}},[e("div",{staticClass:"pieces"},[e("div",{staticClass:"sliders"},[e("div",{staticClass:"button-choices buttons has-addons"},[e("button",{key:"do-something",staticClass:"button is-small",class:{"is-link":!t.isBase,"is-selected":!t.isBase},on:{click:function(a){return t.setBase(!1)}}},[t._v("Alternatives")]),e("button",{key:"base",staticClass:"button is-small",class:{"is-link":t.isBase,"is-selected":t.isBase},on:{click:function(a){return t.setBase(!0)}}},[t._v("What would have happened w/o restrictions")])]),e("div",{staticClass:"selection-widgets",class:{"totally-disabled":t.isBase}},[e("div",{staticClass:"g1"},[e("h5",{staticClass:"title"},[t._v("Percentage of out-of-home activities still occuring after March 23")]),e("p",{staticClass:"subhead"},[t._v("By type (%)")]),t._l(Object.keys(t.state.measures).slice(4),function(a){return e("div",{key:a,staticClass:"myslider"},[e("my-slider",{attrs:{measure:a,state:t.state},on:{changed:t.sliderChanged}})],1)})],2),e("div",{staticClass:"g1"},[e("h5",{staticClass:"title"},[t._v("Reopening of educational facilities on April 20")]),e("p",{staticClass:"subhead"},[t._v("Students Returning (%):")]),t._l(Object.keys(t.state.measures).slice(1,4),function(a){return e("div",{key:a,staticClass:"myslider"},[e("my-slider",{attrs:{measure:a,state:t.state},on:{changed:t.sliderChanged}})],1)})],2)]),e("h5",{staticClass:"cumulative"},[t._v("Cumulative Infected")]),e("p",{staticClass:"infected"},[t._v(t._s(t.prettyInfected))])]),e("div",{staticClass:"log-plot"},[e("h5",[t._v(t._s(t.cityCap)+" Simulated Population Health Outcomes Over Time")]),e("p",[t._v("Log scale")]),e("vue-plotly",{staticClass:"plotsize",attrs:{data:t.data,layout:t.loglayout,options:t.options}})],1),e("div",{staticClass:"linear-plot"},[e("h5",[t._v(t._s(t.cityCap)+" Simulated Population Health Outcomes Over Time")]),e("p",[t._v("Linear scale")]),e("vue-plotly",{staticClass:"plotsize",attrs:{data:t.data,layout:t.layout,options:t.options}})],1)])])])},x=[],I=l(k,w,x,!1,null,"1d45fbb9");const B=I.exports,R=`## v6: School Reopening Scenarios (3)

Here we depict the effects of reopening society at various levels for work, school, leisure and other activities.

- The simulations refer to either the **Berlin** or **Munich** regions (each city plus some surroundings).
- Berlin real-world infections are from [Robert Koch Institute (RKI)](https://npgeo-corona-npgeo-de.hub.arcgis.com/datasets/dd4580c810204019a7b8eb3e0b329dd6_0). For many cases, a delay between infection and reporting may occur.
- After **March 13**, 10% of leisure acts are banned (corresponding to the closure of theaters, etc.). Also, schools / kindergarten / universities are closed. 10 percent of kita and primary-aged children still go to kita / primary schools (Notbetrieb).
- On **March 23**, work, shopping, errands and business are reduced, corresponding to the currently valid "Kontaktsperre"; the percentage of work, leisure, shopping, errands and business activities still occuring after **March 23** can be set.
- Educational facilities can be reopened on **April 20**.

{{PLOTS}}

[Google COVID-19 Mobility report](https://google.com/covid19/mobility) shows for Berlin after March 23:

- retail & recreation down by about 70% (i.e. at about **30%**)
- grocery & pharmacy down by about 20% (i.e. at about **80%**)
- parks down by about 20% (i.e. at about **80%**)
- workplace down by about 40% (i.e. at about **60%**)
  Other than google, we do not take the last day, but take visual averages over about a week.

The best approximation to this with our options below would be:

- **leisure** at **20%** (with the assumption that parks do not contribute that much to infections)
- **work** at **60%**
- **shopping** at **40%**
- **errands & business** at **40%**

If one assumes that the capacity of the Berlin system for critical COVID cases is about 1000, then one finds that there is scant little room to relax restrictions.

Or alternatively: The currently "blunt" restrictions would need to be replaced by something smarter.
`,d=new g({html:!0,linkify:!0,typographer:!0}).render(R),D=c({name:"V6",components:{SectionViewer:B},props:{},data(){return{state:{measures:{},runLookup:{},cumulativeInfected:0,berlinCases:{},publicPath:"/"},readme:{berlin:d,munich:d},plotTag:"{{PLOTS}}",city:"",plusminus:"-5"}},async mounted(){console.log({route:this.$route}),this.city=this.$route.params.city,await this.loadDataInBackground()},computed:{cities(){return["Berlin","Munich"]},topNotes(){const s=this.readme[this.city];if(!s)return"";const t=s.indexOf(this.plotTag);return t<0?s:s.substring(0,t)},bottomNotes(){const s=this.readme[this.city];if(!s)return"";const t=s.indexOf(this.plotTag);return t<0?"":s.substring(t+this.plotTag.length)}},watch:{async $route(s,t){console.log(s),await this.loadDataInBackground(),this.city=s.params.city}},methods:{async loadDataInBackground(){this.state.berlinCases=this.prepareBerlinData();const s=this.state.publicPath+"v6-info-"+this.city+".txt",t=await this.loadCSVData(s);await this.generateScenarioMatrix(t)},prepareBerlinData(){const s=r.parse(y,{header:!0,dynamicTyping:!0,skipEmptyLines:!0}).data;console.log({data:s});const t=[],e=[];let a=0;console.log("fetched berlin data:",s.length);for(const o of s){const n=o.year+"-"+o.month+"-"+o.day;t.push(n),a+=o.cases,e.push(a)}const i={name:"Berlin Infections (RKI)",x:t,y:e,line:{dash:"dot",width:3,color:"rgb(0,200,150)"}};return console.log({berlinSeries:i}),i},async loadCSVData(s){console.log("fetching data");const e=await(await fetch(s)).text(),a=r.parse(e,{header:!0,dynamicTyping:!0});return console.log({parsed:a.data}),a.data},async generateScenarioMatrix(s){console.log("generating lookups");const t={},e={},a=["Config","Output","RunId","RunScript"];for(const i of Object.keys(s[0]))a.indexOf(i)>-1||(t[i]=new Set);for(const i of s){if(!i.RunId)continue;for(const n of Object.keys(t))(i[n]===0||i[n])&&t[n].add(i[n]);let o="";for(const n of Object.keys(t))o+=i[n]+"-";e[o]=i}for(const i of Object.keys(t))t[i]=Array.from(t[i].keys()).sort((o,n)=>o-n);console.log({measures:t,runLookup:e}),this.state.measures=t,this.state.runLookup=e}}});var L=function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",{attrs:{id:"app"}},[e("div",{staticClass:"city-picker"},t._l(t.cities,function(a){return e("router-link",{key:a,staticClass:"which-city",class:{selected:a.toLowerCase()===t.city.toLowerCase()},attrs:{to:"/v6/"+a.toLowerCase()}},[e("h1",[t._v(t._s(a))])])}),1),e("div",{staticClass:"content"},[e("div",{staticClass:"readme",domProps:{innerHTML:t._s(t.topNotes)}}),e("div",{staticClass:"view-section"},[e("section-viewer",{staticClass:"viewer",attrs:{state:t.state,city:t.city}})],1),t.bottomNotes?e("div",{staticClass:"bottom"},[e("h3",[t._v("Further Notes")]),e("div",{staticClass:"readme",domProps:{innerHTML:t._s(t.bottomNotes)}})]):t._e()])])},M=[],O=l(D,L,M,!1,null,"343b4acb");const N=O.exports;export{N as default};
//# sourceMappingURL=V6-CEP6OM50.js.map
