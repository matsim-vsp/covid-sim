import{Y as n}from"./index-Cf7fubil.js";import{M as c,d,P as u,n as h}from"./index-DDqvQHsx.js";const p={messages:{en:{"risk-calculator":"Personal Risk Calculator",badpage:"That page not found, sorry!",released:"Released","estimated-risk":"Estimated Infection Risk","explore-scenarios":"Explore typical scenarios","try-combos":"...or try different combinations below.",remarks:"Remarks"},de:{"risk-calculator":"Personalrisiko Rechner",badpage:"Seite wurde nicht gefunden.",released:"Veröffentlicht","explore-scenarios":"Typische Szenarien erforschen","try-combos":"...oder versuchen Sie verschiedene Kombinationen unten.","estimated-risk":"Geschätztes Infektionsrisiko",remarks:"Bemerkungen"}}},m=new c({html:!0,linkify:!0,typographer:!0}),f=d({name:"RiskCalculator",i18n:p,components:{},props:{},data(){return{calcId:"",yaml:{description:"",calibrationParam:.075,multipliers:{},divisors:{},scenarios:{},notes:[]},badPage:!1,selectedScenario:{},finalR:0,adjustedR:0,lookup:{},sliders:{},factors:{},divFactors:{}}},mounted(){this.buildPageForURL()},computed:{multipliers(){return Object.keys(this.yaml.multipliers)},divisors(){return Object.keys(this.yaml.divisors)}},watch:{$route(){this.buildPageForURL()}},methods:{parseMarkdown(e){return m.render(e)},async buildPageForURL(){this.badPage=!1,this.calcId=this.$route.params.rcalc;const e=this.$i18n.locale,s=u+`risk-calculator/${this.calcId}.${e}.yaml`;let t="";try{t=await(await fetch(s)).text()}catch(i){console.error(i)}if(!t&&s.indexOf(".de.")>-1){console.warn("no",s,"falling back to .en.");const i=s.replace(".de.",".en.");console.log(i);try{t=await(await fetch(i)).text()}catch(a){console.error(a)}}if(!t){this.badPage=!0;return}this.yaml=n.parse(t),this.buildUI(),this.updateR()},async handleDivFactorButton(e){const s=this.sliders[e],t=this.lookup[e][s];this.divFactors[e]=t.value,this.updateR(),this.$forceUpdate()},async handleFactorButton(e){const s=this.sliders[e],t=this.lookup[e][s];this.factors[e]=t.value,this.updateR(),this.$forceUpdate()},async handleScenario(e){this.selectedScenario=this.yaml.scenarios[e];for(const s of Object.keys(this.selectedScenario.presets)){const t=this.selectedScenario.presets[s],i=this.lookup[s].find(a=>a.title===t).value;console.log(s,t,i),this.multipliers.indexOf(s)>-1&&(this.factors[s]=i),this.divisors.indexOf(s)>-1&&(this.divFactors[s]=i);for(let a=0;a<this.lookup[s].length;a++)if(this.lookup[s][a].title===t){this.sliders[s]=a;break}}this.updateR(),this.$forceUpdate()},updateR(){let e=this.yaml.calibrationParam;for(const s of Object.values(this.factors))e*=s;for(const s of Object.values(this.divFactors))e*=s;e=1-Math.exp(-1*e),this.finalR=Math.min(99,e*100),this.animateTowardNewRValue()},animateTowardNewRValue(){const e=this.finalR-this.adjustedR,s=this.adjustedR+e*.2;this.adjustedR=s,Math.abs(this.adjustedR-this.finalR)<.01?this.adjustedR=this.finalR:setTimeout(this.animateTowardNewRValue,16)},buildUI(){for(const e of Object.keys(this.yaml.multipliers)){const s=this.yaml.multipliers[e];this.lookup[e]=[];for(let t=0;t<s.options.length;t++){const i=s.options[t],a=Object.keys(i)[0],o=i[a];if(!isNaN(o))this.lookup[e].push({title:a,value:o}),this.yaml.multipliers[e].options===void 0&&(this.factors[e]=o,this.sliders[e]=t);else{const r=parseFloat(o.substring(0,o.length-1)),l={title:a,value:r};this.lookup[e].push(l),this.sliders[e]=t,this.factors[e]=r}}}for(const e of Object.keys(this.yaml.divisors)){const s=this.yaml.divisors[e];this.lookup[e]=[];for(let t=0;t<s.options.length;t++){const i=s.options[t],a=Object.keys(i)[0],o=i[a];if(!isNaN(o))this.lookup[e].push({title:a,value:1/o}),this.yaml.divisors[e].options===void 0&&(this.divFactors[e]=o,this.sliders[e]=t);else{const r=1/parseFloat(o.substring(0,o.length-1)),l={title:a,value:r};this.lookup[e].push(l),this.sliders[e]=t,this.divFactors[e]=r}}}}}});var v=function(){var s=this,t=s._self._c;return s._self._setupProxy,t("div",{staticClass:"rcc"},[s._m(0),s.yaml.multipliers?t("div",{staticClass:"center-area"},[t("h2",[s._v(s._s(s.$t("risk-calculator")))]),t("h5",{style:{marginBottom:"1rem",color:"#596"}},[s._v(s._s(s.$t("released"))+" "+s._s(this.calcId))]),s.badPage?t("h3",{staticClass:"badpage"},[s._v(s._s(s.$t("badpage")))]):t("div",{staticClass:"goodpage"},[s.yaml.description?t("p",[s._v(s._s(s.yaml.description))]):s._e(),t("h3",[t("b",[s._v(s._s(s.$t("explore-scenarios"))+":")])]),t("div",{staticClass:"measures"},s._l(Object.keys(s.yaml.scenarios),function(i){return t("div",{key:i,staticClass:"measure"},[t("button",{staticClass:"button is-danger is-outlined is-small",on:{click:function(a){return s.handleScenario(i)}}},[s._v(s._s(i))])])}),0),t("p",[s._v(s._s(s.selectedScenario?s.selectedScenario.description:s.$t("try-combos")))])])]):s._e(),t("h3",{staticClass:"center-area sticky"},[t("b",[s._v(s._s(s.$t("estimated-risk"))+": "),t("span",{staticClass:"greenbig",style:{fontSize:"2.5rem",fontWeight:"bold",color:"#596"}},[s._v(s._s(s.adjustedR.toFixed(1))+"%")])])]),s.yaml.multipliers?t("div",{staticClass:"center-area"},[t("div",{staticClass:"option-groups"},[s._l(s.multipliers,function(i){return t("div",{key:`add+${i}`,staticClass:"option-group"},[t("h4",[s._v(s._s(i))]),t("div",{staticClass:"description"},[s._v(s._s(s.yaml.multipliers[i].description))]),t("b-slider",{staticClass:"slider",attrs:{value:0,min:0,max:s.lookup[i].length-1,tooltip:!1,size:"is-large"},on:{input:function(a){return s.handleFactorButton(i)}},model:{value:s.sliders[i],callback:function(a){s.$set(s.sliders,i,a)},expression:"sliders[group]"}},s._l(s.lookup[i],function(a,o){return t("b-slider-tick",{key:a.title,attrs:{value:o}})}),1),t("p",{staticClass:"slider-label"},[s._v(s._s(s.lookup[i][s.sliders[i]].title))])],1)}),s._l(s.divisors,function(i){return t("div",{key:i,staticClass:"option-group"},[t("h4",[s._v(s._s(i))]),t("div",{staticClass:"description"},[s._v(s._s(s.yaml.divisors[i].description))]),t("b-slider",{staticClass:"slider",attrs:{value:0,min:0,max:s.lookup[i].length-1,tooltip:!1,size:"is-large"},on:{input:function(a){return s.handleDivFactorButton(i)}},model:{value:s.sliders[i],callback:function(a){s.$set(s.sliders,i,a)},expression:"sliders[group]"}},s._l(s.lookup[i],function(a,o){return t("b-slider-tick",{key:a.title,attrs:{value:o}})}),1),t("p",{staticClass:"slider-label"},[s._v(s._s(s.lookup[i][s.sliders[i]].title))])],1)}),t("br"),s.yaml.notes?t("h3",[t("b",[s._v(s._s(s.$t("remarks"))+":")])]):s._e(),s.yaml.notes?t("ul",s._l(s.yaml.notes,function(i){return t("li",{staticClass:"notes-item",domProps:{innerHTML:s._s(s.parseMarkdown(i))}})}),0):s._e()],2)]):s._e()])},_=[function(){var e=this,s=e._self._c;return e._self._setupProxy,s("div",{staticClass:"banner"},[s("h2",[e._v("VSP / Technische Universität Berlin")]),s("h3",[e._v("COVID-19 Analysis Portal")])])}],k=h(f,v,_,!1,null,"2f2487aa");const R=k.exports;export{R as default};
//# sourceMappingURL=RiskCalculator-iLwApFpA.js.map
