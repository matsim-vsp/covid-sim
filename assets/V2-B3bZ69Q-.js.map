{"version":3,"file":"V2-B3bZ69Q-.js","sources":["../../src/runs/v2/SelectWidget.vue","../../src/runs/v2/ChartSelector.vue","../../src/assets/v2-notes.md?raw","../../src/runs/v2/V2.vue"],"sourcesContent":["<template lang=\"pug\">\n.slider-thing\n  vue-slide-bar.my-slider(:speed=\"0\" :data=\"stops\" v-model=\"value\")\n  p {{ measureTitle }}\n\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue'\nimport type { PropType } from 'vue'\n\nimport VueSlideBar from 'vue-slide-bar'\n\nexport default defineComponent({\n  name: 'SelectWidget',\n  components: { VueSlideBar },\n  props: {\n    state: { type: Object, required: true },\n    measure: { type: String, required: true },\n  },\n\n  data() {\n    return {\n      value: 0 as any,\n      stops: [0, 1000],\n\n      interventions: {\n        remainingFractionWork: 'Still going to work',\n        remainingFractionShopping: 'Still shopping',\n        remainingFractionLeisure: 'Still doing leisure activities',\n        remainingFractionOther: 'Still doing other activities',\n        ReopenAfter: 'Lift Shutdown After X Days',\n      } as any,\n    }\n  },\n\n  mounted() {\n    const experiments = []\n    for (const x of this.state.measures[this.measure]) {\n      experiments.push(x === 1000 ? 'Never' : x)\n    }\n\n    this.stops = experiments.map(x => (x <= 1 ? x * 100 : x))\n    this.value = 'Never'\n  },\n\n  computed: {\n    measureTitle() {\n      return this.interventions[this.measure]\n    },\n  },\n\n  watch: {\n    value() {\n      let answer = this.value\n      if (answer === 'Never') answer = 1000\n      else if (answer !== 21) answer = 0.01 * answer\n      this.$emit('changed', this.measure, answer)\n    },\n  },\n})\n</script>\n\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\n<style scoped>\n.my-slider {\n  margin-top: 1rem;\n}\n\n@media only screen and (max-width: 768px) {\n  .my-slider {\n    margin-top: 0.25rem;\n  }\n}\n</style>\n","<template lang=\"pug\">\n#main-section\n  .pieces\n    .sliders\n      h5 Intervention Options\n      p.subhead Percent Noncompliance:\n\n      .myslider(v-for=\"measure in Object.keys(state.measures)\" :key=\"measure\")\n        my-slider(:measure=\"measure\" :state=\"state\" @changed=\"sliderChanged\")\n\n    .linear-plot\n      h5 Simulated Population Health Outcomes Over Time\n      p Linear scale\n      vue-plotly.plotsize(:data=\"data\" :layout=\"layout\" :options=\"options\")\n\n    .log-plot\n      h5 Simulated Population Health Outcomes Over Time\n      p Log scale\n      vue-plotly.plotsize(:data=\"data\" :layout=\"loglayout\" :options=\"options\")\n\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue'\nimport type { PropType } from 'vue'\n\nimport ZipLoader from 'zip-loader'\n\nimport Papa from '@simwrapper/papaparse'\nimport VuePlotly from '@/components/VuePlotly.vue'\nimport MySlider from './SelectWidget.vue'\n\nexport default defineComponent({\n  name: 'ChartSelector',\n  components: { MySlider, VuePlotly },\n  props: {\n    state: { type: Object, required: true },\n  },\n\n  data() {\n    return {\n      currentRun: {} as any,\n      data: [] as any[],\n      layout: {\n        autosize: true,\n        legend: {\n          orientation: 'h',\n        },\n        font: {\n          family: 'Roboto,Arial,Helvetica,sans-serif',\n          size: 12,\n          color: '#000',\n        },\n        margin: { l: 50, t: 10, r: 10, b: 0 },\n        yaxis: {\n          autorange: true,\n        },\n        xaxis: {},\n      },\n      loglayout: {\n        autosize: true,\n        legend: {\n          orientation: 'h',\n        },\n        font: {\n          family: 'Roboto,Arial,Helvetica,sans-serif',\n          size: 12,\n          color: '#000',\n        },\n        margin: { l: 50, t: 10, r: 10, b: 0 },\n        yaxis: {\n          type: 'log',\n          autorange: true,\n        },\n      },\n      options: {\n        displayModeBar: false,\n        responsive: true,\n      },\n      currentSituation: {} as any,\n      loadedSeriesData: {} as any,\n      zipLoader: {} as any,\n\n      labels: {\n        nSusceptible: 'Susceptible',\n        nInfectedButNotContagious: 'Infected, not contagious',\n        nContagious: 'Contagious',\n        nSeriouslySick: 'Seriously Sick',\n        nCritical: 'Critical',\n        nTotalInfected: 'Total Infected',\n        nInfectedCumulative: 'Infected Cumulative',\n        nRecovered: 'Recovered',\n        nInQuarantine: 'In Quarantine',\n      } as any,\n    }\n  },\n\n  mounted() {\n    this.loadZipData()\n  },\n\n  methods: {\n    async loadZipData() {\n      this.zipLoader = new ZipLoader(this.state.publicPath + 'v2-data.zip')\n\n      await this.zipLoader.load()\n\n      console.log('zip loaded!')\n      this.runChanged()\n    },\n\n    async runChanged() {\n      console.log({ run: this.currentRun })\n\n      if (this.loadedSeriesData[this.currentRun.RunId]) {\n        this.data = this.loadedSeriesData[this.currentRun.RunId]\n        return\n      }\n\n      const csv: any[] = await this.loadCSV(this.currentRun)\n      const timeSerieses = this.generateSeriesFromCSVData(csv)\n\n      // cache the result\n      this.loadedSeriesData[this.currentRun.RunId] = timeSerieses\n\n      this.data = timeSerieses\n    },\n\n    sliderChanged(measure: any, value: any) {\n      this.currentSituation[measure] = value\n      this.showPlotForCurrentSituation()\n    },\n\n    showPlotForCurrentSituation() {\n      let lookupKey = ''\n      for (const measure of Object.keys(this.state.measures))\n        lookupKey += this.currentSituation[measure] + '-'\n\n      this.currentRun = this.state.runLookup[lookupKey]\n      if (!this.currentRun) return\n\n      this.runChanged()\n    },\n\n    unpack(rows: any[], key: any) {\n      let v = rows.map(function (row) {\n        if (key === 'day') return row[key]\n        return row[key] // * 4\n      })\n\n      v = v.slice(0, 150)\n\n      // maybe the sim ended early - go out to 150 anyway\n      if (v.length < 150) {\n        v.push(key === 'day' ? 150 : v[v.length - 1])\n      }\n\n      return v\n    },\n\n    async loadCSV(currentRun: any) {\n      if (!currentRun.RunId) return []\n\n      const filename = currentRun.RunId + '.infections.txt'\n      console.log('Extracting', filename)\n\n      let text = this.zipLoader.extractAsText(filename)\n      const z = Papa.parse(text, { header: true, dynamicTyping: true, skipEmptyLines: true })\n\n      return z.data\n    },\n\n    generateSeriesFromCSVData(data: any[]) {\n      const serieses = []\n\n      const x: number[] = this.unpack(data, 'day')\n\n      for (const column of Object.keys(this.labels)) {\n        const name = this.labels[column]\n        const y: number[] = this.unpack(data, column)\n        serieses.push({ x, y, name })\n      }\n\n      return serieses\n    },\n  },\n})\n</script>\n\n<style scoped>\n#main-section {\n  background-color: white;\n  display: flex;\n  flex-direction: row;\n}\n\n.categories {\n  display: flex;\n  flex-direction: column;\n}\n\nh5 {\n  font-weight: bold;\n  font-size: 18px;\n}\n\n.plot h5 {\n  color: #667883;\n  text-align: center;\n  margin-top: 5rem;\n}\n\n.pieces {\n  padding: 2rem 0rem;\n  display: grid;\n  width: 100%;\n  grid-gap: 1rem;\n  grid-template-columns: auto 1fr;\n  grid-template-rows: auto;\n}\n\n.pieces h3 {\n  color: #667883;\n  border-bottom: 1px solid #ddd;\n  padding-bottom: 0.5rem;\n  margin: 1rem 1rem 2rem 0rem;\n  text-transform: uppercase;\n  letter-spacing: 2px;\n}\n\n.sliders {\n  grid-column: 1 / 2;\n  grid-row: 1 / 3;\n  margin-right: 3rem;\n  display: flex;\n  flex-direction: column;\n}\n\n.linear-plot {\n  text-align: center;\n  height: 30rem;\n  grid-column: 2 / 3;\n  grid-row: 2 / 3;\n  display: flex;\n  flex-direction: column;\n}\n\n.log-plot {\n  margin-top: 2rem;\n  text-align: center;\n  grid-column: 2 / 3;\n  grid-row: 1 / 2;\n  display: flex;\n  flex-direction: column;\n}\n\n.plotsize {\n  height: 30rem;\n}\n\np.subhead {\n  margin-top: -0.25rem;\n}\n\n.myslider {\n  width: 100%;\n  margin-left: 0.5rem;\n}\n\n.plot {\n  grid-column: 1 / 2;\n  grid-row: 1 / 2;\n  padding: 1rem 0rem;\n}\n\n@media only screen and (max-width: 640px) {\n  #main-section {\n    flex-direction: column;\n    padding: 0 0;\n    margin: 0 0rem;\n  }\n\n  .pieces {\n    padding: 1rem 1rem;\n    display: flex;\n    flex-direction: column;\n  }\n\n  .linear-plot {\n    margin-top: 2rem;\n  }\n  .sliders {\n    width: 15rem;\n  }\n}\n</style>\n","export default \"## v2: Examining adherence rates for stay-at-home orders\\n\\nThe interventions below depict disease spread following various levels of adherence with stay-at-home policies.\\n\\n- The simulations refer to the **Berlin** region (Berlin city plus some surroundings).\\n- The simulations begin on Day 0, with 40 infected individuals in the population.\\n- Intervention measures go into effect on day 30.\\n\\nThe **base doubling time is approx. 2.1 days**. It corresponds to the German growth rate end Feb/begin Mar, with neither policy measures nor cultural adaptations.\\n\"","<template lang=\"pug\">\n.zapp\n  .content\n    p.readme(v-html=\"readme\")\n\n  section-viewer.viewer(:state=\"state\")\n\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue'\nimport type { PropType } from 'vue'\n\nimport Papa from '@simwrapper/papaparse'\nimport SectionViewer from './ChartSelector.vue'\n\nimport md from 'markdown-it'\nconst mdParser = new md()\nimport readme from '@/assets/v2-notes.md?raw'\n\nexport default defineComponent({\n  name: 'V2',\n  components: { SectionViewer },\n  data() {\n    return {\n      state: {\n        measures: {},\n        runLookup: {},\n        publicPath: '/',\n      },\n      readme: mdParser.render(readme, {}),\n    }\n  },\n\n  async mounted() {\n    const parsed = await this.loadIndexData()\n    const matrix = await this.generateScenarioMatrix(parsed)\n  },\n\n  methods: {\n    async loadIndexData() {\n      console.log('fetching data')\n      const response = await fetch(this.state.publicPath + 'v2-info.txt')\n      const text = await response.text()\n      const parsed: any = Papa.parse(text, { header: true, dynamicTyping: true })\n      console.log({ parsed: parsed.data })\n\n      return parsed.data\n    },\n\n    async generateScenarioMatrix(parsed: any[]) {\n      console.log('generating lookups')\n      const measures: any = {}\n      const runLookup: any = {}\n\n      // first get column names for the measures that have been tested\n      const ignore = ['Config', 'Output', 'RunId', 'RunScript']\n\n      for (const label of Object.keys(parsed[0])) {\n        if (ignore.indexOf(label) > -1) continue\n        measures[label] = new Set()\n      }\n\n      // get all possible values\n      for (const run of parsed) {\n        if (!run.RunId) continue\n\n        // note this particular value, for every value\n        for (const measure of Object.keys(measures)) {\n          if (run[measure] === 0 || run[measure]) measures[measure].add(run[measure])\n        }\n\n        // store the run in a lookup using all values as the key\n        let lookupKey = ''\n        for (const measure of Object.keys(measures)) lookupKey += run[measure] + '-'\n        runLookup[lookupKey] = run\n      }\n\n      for (const measure of Object.keys(measures)) {\n        measures[measure] = Array.from(measures[measure].keys()).sort((a: any, b: any) => a - b)\n      }\n\n      console.log({ measures, runLookup })\n      this.state.measures = measures\n      this.state.runLookup = runLookup\n    },\n  },\n})\n</script>\n\n<style scoped>\n.zapp {\n  color: #222;\n  display: flex;\n  flex-direction: column;\n  margin: 0rem 0rem;\n  padding: 0px 0px;\n  font-family: Roboto, Avenir, Helvetica, Arial, sans-serif;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n.nav-bar {\n  position: fixed;\n  width: 100%;\n  top: 0px;\n  background-color: white;\n  box-shadow: 0px 5px 10px #44444440;\n  padding: 0rem 0rem 0rem 1rem;\n  z-index: 5;\n}\n\n.address-header {\n  margin-top: 4rem;\n  background-color: #d3e1ee;\n  padding: 3rem 10rem;\n}\n\n.address-header h2 {\n  font-size: 2.5rem;\n  font-weight: bold;\n}\n\n.address-header h3 {\n  font-size: 1rem;\n  font-weight: normal;\n  margin-top: -0.5rem;\n}\n\n.content {\n  padding: 0rem 3rem;\n  margin: 2rem 0rem;\n  padding-bottom: 1rem;\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n}\n\n.viewer {\n  padding: 0rem 2rem;\n  margin: 0rem 0rem;\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n}\n\n.footer {\n  text-align: center;\n  padding: 2rem 0.5rem;\n  background-color: #627785;\n}\n\n.footer p {\n  color: white;\n}\n\n.footer a {\n  color: #334;\n}\n\n.footer img {\n  margin: 1rem auto;\n  padding: 0 1rem;\n}\n\n@media only screen and (max-width: 768px) {\n  .content {\n    padding: 0rem 1rem;\n    margin-top: 2rem;\n    grid-template-columns: 1fr;\n    grid-template-rows: auto auto auto;\n    row-gap: 1rem;\n  }\n\n  .address-header {\n    padding-left: 2rem;\n  }\n}\n</style>\n"],"names":["_sfc_main$2","defineComponent","VueSlideBar","experiments","x","answer","_sfc_main$1","MySlider","VuePlotly","ZipLoader","csv","timeSerieses","measure","value","lookupKey","rows","key","v","row","currentRun","filename","text","Papa","data","serieses","column","name","y","readme","mdParser","md","_sfc_main","SectionViewer","parsed","measures","runLookup","ignore","label","run","a","b"],"mappings":"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"}