import{P as u}from"./papaparse.min-D_Jh_NJ5.js";import{d as r,n as l,M as c}from"./index-DDqvQHsx.js";import{V as d}from"./VuePlotly-Dd8e5QjM.js";import{Z as p}from"./zip-loader.module-BRLILkva.js";import{V as h}from"./vue-slide-bar.min-CUEHg1O-.js";const m=r({name:"SelectWidget",components:{VueSlideBar:h},props:{state:{type:Object,required:!0},measure:{type:String,required:!0}},data(){return{value:0,stops:[0,1e3],showButtons:!1,showSlider:!0,interventions:{remainingFractionKiga:"Going to kindergarten",remainingFractionPrimary:"Going to primary school",remainingFractionSecondary:"Going to secondary school",remainingFractionHigher:"Going to univ./higher ed.",ShutdownType:"Shutdown type"}}},mounted(){const s=[];for(const e of this.state.measures[this.measure]){let t=e;e==="weak"&&(t="Type A"),e==="strong"&&(t="Type B"),isNaN(t)&&(this.showButtons||(this.value=t),this.showButtons=!0,this.showSlider=!1),s.push(t)}this.stops=s.map(e=>e<=1?e*100:e),this.showSlider&&(this.value="Never")},computed:{measureTitle(){return this.interventions[this.measure]}},watch:{value(){let s=this.value;s==="Never"?s=1e3:s==="Type A"?s="weak":s==="Type B"?s="strong":isNaN(s)||(s=.01*s),this.$emit("changed",this.measure,s)}},methods:{choseButton(s){console.log(s),this.value=s}}});var f=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{attrs:{id:"slider-thing"}},[e.showSlider?t("vue-slide-bar",{staticClass:"my-slider",attrs:{speed:0,data:e.stops},model:{value:e.value,callback:function(n){e.value=n},expression:"value"}}):e._e(),e.showButtons?t("div",{staticClass:"button-choices"},e._l(e.stops,function(n){return t("button",{key:n,staticClass:"button is-small",class:{"is-link":n===e.value},on:{click:function(a){return e.choseButton(n)}}},[e._v(e._s(n))])}),0):e._e(),t("p",[e._v(e._s(e.measureTitle))])],1)},y=[],v=l(m,f,y,!1,null,"d5b126fc");const g=v.exports,_=r({name:"ChartSelector",components:{MySlider:g,VuePlotly:d},props:{state:{type:Object,required:!0}},data(){return{currentRun:{},data:[],layout:{autosize:!0,legend:{orientation:"h"},font:{family:"Roboto,Arial,Helvetica,sans-serif",size:12,color:"#000"},margin:{l:50,t:10,r:10,b:0},yaxis:{autorange:!0},xaxis:{}},loglayout:{autosize:!0,legend:{orientation:"h"},font:{family:"Roboto,Arial,Helvetica,sans-serif",size:12,color:"#000"},margin:{l:50,t:10,r:10,b:0},yaxis:{type:"log",autorange:!0}},options:{displayModeBar:!1,responsive:!0},currentSituation:{},loadedSeriesData:{},zipLoader:{},labels:{nSusceptible:"Susceptible",nInfectedButNotContagious:"Infected, not contagious",nContagious:"Contagious",nSeriouslySick:"Seriously Sick",nCritical:"Critical",nTotalInfected:"Total Infected",nInfectedCumulative:"Infected Cumulative",nRecovered:"Recovered",nInQuarantine:"In Quarantine"}}},mounted(){this.loadZipData()},computed:{prettyInfected(){if(!this.state.cumulativeInfected)return"";const s=100*Math.round(this.state.cumulativeInfected*.01);return Number(s).toLocaleString()}},methods:{async loadZipData(){this.zipLoader=new p(this.state.publicPath+"v4-data.zip"),await this.zipLoader.load(),console.log("zip loaded!"),this.runChanged()},async runChanged(){if(console.log({run:this.currentRun}),this.loadedSeriesData[this.currentRun.RunId]){this.data=this.loadedSeriesData[this.currentRun.RunId],this.updateTotalInfected();return}const s=await this.loadCSV(this.currentRun),e=this.generateSeriesFromCSVData(s);this.loadedSeriesData[this.currentRun.RunId]=e,this.data=e,this.updateTotalInfected()},updateTotalInfected(){const s=this.data.filter(e=>e.name==="Infected Cumulative")[0];this.state.cumulativeInfected=s.y[149]},sliderChanged(s,e){console.log(s,e),this.currentSituation[s]=e,this.showPlotForCurrentSituation()},showPlotForCurrentSituation(){let s="";for(const e of Object.keys(this.state.measures))s+=this.currentSituation[e]+"-";console.log(s),this.currentRun=this.state.runLookup[s],this.currentRun&&this.runChanged()},unpack(s,e){let t=s.map(function(n){return n[e]});return t=t.slice(0,150),t.length<150&&t.push(e==="day"?150:t[t.length-1]),t},async loadCSV(s){if(!s.RunId)return[];const e=s.RunId+".infections.txt";console.log("Extracting",e);let t=this.zipLoader.extractAsText(e);return u.parse(t,{header:!0,dynamicTyping:!0,skipEmptyLines:!0}).data},generateSeriesFromCSVData(s){const e=[],t=this.unpack(s,"day");for(const n of Object.keys(this.labels)){const a=this.labels[n],i=this.unpack(s,n);e.push({x:t,y:i,name:a})}return e}}});var S=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"main-section"},[t("div",{staticClass:"pieces"},[t("div",{staticClass:"sliders"},[t("h5",[e._v("Shutdown Type")]),e._l(Object.keys(e.state.measures),function(n){return t("div",{key:"x"+n,staticClass:"myslider"},[n==="ShutdownType"?t("my-slider",{staticClass:"gap",attrs:{measure:n,state:e.state},on:{changed:e.sliderChanged}}):e._e()],1)}),t("br"),t("h5",[e._v("School Attendance")]),t("p",{staticClass:"subhead"},[e._v("Percent Still Attending:")]),e._l(Object.keys(e.state.measures),function(n){return t("div",{key:n,staticClass:"myslider"},[n!="ShutdownType"?t("my-slider",{attrs:{measure:n,state:e.state},on:{changed:e.sliderChanged}}):e._e()],1)}),e._m(0),t("p",{staticClass:"infected"},[e._v(e._s(e.prettyInfected))])],2),t("div",{staticClass:"linear-plot"},[t("h5",[e._v("Simulated Population Health Outcomes Over Time")]),t("p",[e._v("Linear scale")]),t("vue-plotly",{staticClass:"plotsize",attrs:{data:e.data,layout:e.layout,options:e.options}})],1),t("div",{staticClass:"log-plot"},[t("h5",[e._v("Simulated Population Health Outcomes Over Time")]),t("p",[e._v("Log scale")]),t("vue-plotly",{staticClass:"plotsize",attrs:{data:e.data,layout:e.loglayout,options:e.options}})],1)])])},b=[function(){var s=this,e=s._self._c;return s._self._setupProxy,e("h5",{staticClass:"cumulative"},[s._v("Cumulative Infected"),e("br"),s._v("by Day 150")])}],C=l(_,S,b,!1,null,"f2b83ffb");const w=C.exports,k=`## v4: School Reopening Scenarios (1)

V4 attempts to replay the development so far, and explores results of various school attendance scenarios and two levels of restrictions on non-school activity:

- The simulations refer to the **Berlin** region (Berlin city plus some surroundings).
- The **base doubling time is approx. 3 days**. It corresponds to the German growth rate 2nd & 3rd week of Mar, i.e. with slight cultural adaptations but not policy interventions.
- On **day 26**, 10% of leisure acts are banned (corresponding to the closure of theaters, etc.) Also, schools / kindergarten / universities are closed. 10 percent of kita and primary-aged children still go to kita / primary schools (Notbetrieb)
- On **day 35**, work, shopping, errands and business are restricted, corresponding to the currently valid "Kontaktsperre":
  - **Type A**: Work and shopping 60% reduced; leisure, business and errands 80% reduced
  - **Type B**: Work and shopping 80% reduced; leisure, business and errands 90% reduced
- On **day 63**, educational facilities can be reopened (estimated to be the 20th of April).

Some results:
- The **doubling time of the intervention of "Type A" is approx. 13 days**, which is _more optimistic_ than what we currently measure (approx. 9 days).
- "Type B" is even more optimistic.

What has changed compring to v2?

- Inclusion of school population
`,x=new c({html:!0,linkify:!0,typographer:!0}).render(k),I=r({name:"V4",components:{SectionViewer:w},props:{},data(){return{state:{measures:{},runLookup:{},cumulativeInfected:0,publicPath:"/"},readme:x}},async mounted(){const s=await this.loadIndexData();await this.generateScenarioMatrix(s)},computed:{},watch:{},methods:{async loadIndexData(){console.log("fetching data");const e=await(await fetch(this.state.publicPath+"v4-info.txt")).text(),t=u.parse(e,{header:!0,dynamicTyping:!0});return console.log({parsed:t.data}),t.data},async generateScenarioMatrix(s){console.log("generating lookups");const e={},t={},n=["Config","Output","RunId","RunScript"];for(const a of Object.keys(s[0]))n.indexOf(a)>-1||(e[a]=new Set);for(const a of s){if(!a.RunId)continue;for(const o of Object.keys(e))(a[o]===0||a[o])&&e[o].add(a[o]);let i="";for(const o of Object.keys(e))i+=a[o]+"-";t[i]=a}for(const a of Object.keys(e))e[a]=Array.from(e[a].keys()).sort((i,o)=>i-o);console.log({measures:e,runLookup:t}),this.state.measures=e,this.state.runLookup=t}}});var T=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("div",{staticClass:"app"},[t("div",{staticClass:"content"},[t("div",{staticClass:"readme",domProps:{innerHTML:e._s(e.readme)}})]),t("section-viewer",{staticClass:"viewer",attrs:{state:e.state}})],1)},R=[],O=l(I,T,R,!1,null,"5f55899e");const V=O.exports;export{V as default};
//# sourceMappingURL=V4-B0dC6LHQ.js.map
