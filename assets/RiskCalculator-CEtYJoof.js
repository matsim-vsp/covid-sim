import{Y as l}from"./index-Q6LdGePs.js";import{M as n,d as c,P as d,n as u}from"./index-0C2fXxTn.js";import{V as h}from"./default-DRReGOFN.js";const p={messages:{en:{"risk-calculator":"Personal Risk Calculator",badpage:"That page not found, sorry!",released:"Released","estimated-risk":"Estimated Infection Risk","explore-scenarios":"Explore typical scenarios","try-combos":"...or try different combinations below.",remarks:"Remarks"},de:{"risk-calculator":"Personalrisiko Rechner",badpage:"Seite wurde nicht gefunden.",released:"Veröffentlicht","explore-scenarios":"Typische Szenarien erforschen","try-combos":"...oder versuchen Sie verschiedene Kombinationen unten.","estimated-risk":"Geschätztes Infektionsrisiko",remarks:"Bemerkungen"}}},m=new n({html:!0,linkify:!0,typographer:!0}),f=c({name:"RiskCalculator",i18n:p,components:{VueSlider:h},props:{},data(){return{calcId:"",yaml:{description:"",calibrationParam:.075,multipliers:{},divisors:{},scenarios:{},notes:[]},badPage:!1,selectedScenario:{},sliders:{},finalR:0,adjustedR:0,lookup:{},factors:{},divFactors:{}}},mounted(){this.buildPageForURL()},computed:{multipliers(){return Object.keys(this.yaml.multipliers)},divisors(){return Object.keys(this.yaml.divisors)}},watch:{$route(){this.buildPageForURL()}},methods:{parseMarkdown(t){return m.render(t)},async buildPageForURL(){this.badPage=!1,this.calcId=this.$route.params.rcalc;const t=this.$i18n.locale,s=d+`risk-calculator/${this.calcId}.${t}.yaml`;let e="";try{e=await(await fetch(s)).text()}catch(i){console.error(i)}if(!e&&s.indexOf(".de.")>-1){console.warn("no",s,"falling back to .en.");const i=s.replace(".de.",".en.");console.log(i);try{e=await(await fetch(i)).text()}catch(a){console.error(a)}}if(!e){this.badPage=!0;return}this.yaml=l.parse(e),this.buildUI(),this.updateR()},async handleDivFactorButton(t){const s=this.sliders[t];this.divFactors[t]=s.value,this.updateR(),this.$forceUpdate()},async handleFactorButton(t){const s=this.sliders[t];this.factors[t]=s.value,this.updateR(),this.$forceUpdate()},async handleScenario(t){this.selectedScenario=this.yaml.scenarios[t];for(const s of Object.keys(this.selectedScenario.presets)){const e=this.selectedScenario.presets[s],i=this.lookup[s].find(a=>a.title===e).value;console.log(s,e,i),this.multipliers.indexOf(s)>-1&&(this.factors[s]=i),this.divisors.indexOf(s)>-1&&(this.divFactors[s]=i);for(const a of this.lookup[s])if(a.title===e){this.sliders[s]=a;break}}this.updateR(),this.$forceUpdate()},updateR(){let t=this.yaml.calibrationParam;for(const s of Object.values(this.factors))t*=s;for(const s of Object.values(this.divFactors))t*=s;t=1-Math.exp(-1*t),this.finalR=Math.min(99,t*100),this.animateTowardNewRValue()},animateTowardNewRValue(){const t=this.finalR-this.adjustedR,s=this.adjustedR+t*.2;this.adjustedR=s,Math.abs(this.adjustedR-this.finalR)<.01?this.adjustedR=this.finalR:setTimeout(this.animateTowardNewRValue,16)},buildUI(){for(const t of Object.keys(this.yaml.multipliers)){const s=this.yaml.multipliers[t];this.lookup[t]=[];for(const e of s.options){const i=Object.keys(e)[0],a=e[i];if(!isNaN(a))this.lookup[t].push({title:i,value:a}),this.yaml.multipliers[t].options===void 0&&(this.factors[t]=a,this.sliders[t]=this.lookup[t][0]);else{const o=parseFloat(a.substring(0,a.length-1)),r={title:i,value:o};this.lookup[t].push(r),this.sliders[t]=r,this.factors[t]=o}}}for(const t of Object.keys(this.yaml.divisors)){const s=this.yaml.divisors[t];this.lookup[t]=[];for(const e of s.options){const i=Object.keys(e)[0],a=e[i];if(!isNaN(a))this.lookup[t].push({title:i,value:1/a}),this.yaml.divisors[t].options===void 0&&(this.divFactors[t]=a,this.sliders[t]=this.lookup[t][0]);else{const o=1/parseFloat(a.substring(0,a.length-1)),r={title:i,value:o};this.lookup[t].push(r),this.sliders[t]=r,this.divFactors[t]=o}}}}}});var v=function(){var s=this,e=s._self._c;return s._self._setupProxy,e("div",{staticClass:"rcc"},[s._m(0),s.yaml.multipliers?e("div",{staticClass:"center-area"},[e("h2",[s._v(s._s(s.$t("risk-calculator")))]),e("h5",{style:{marginBottom:"1rem",color:"#596"}},[s._v(s._s(s.$t("released"))+" "+s._s(this.calcId))]),s.badPage?e("h3",{staticClass:"badpage"},[s._v(s._s(s.$t("badpage")))]):e("div",{staticClass:"goodpage"},[s.yaml.description?e("p",[s._v(s._s(s.yaml.description))]):s._e(),e("h3",[e("b",[s._v(s._s(s.$t("explore-scenarios"))+":")])]),e("div",{staticClass:"measures"},s._l(Object.keys(s.yaml.scenarios),function(i){return e("div",{key:i,staticClass:"measure"},[e("button",{staticClass:"button is-danger is-outlined is-small",on:{click:function(a){return s.handleScenario(i)}}},[s._v(s._s(i))])])}),0),e("p",[s._v(s._s(s.selectedScenario?s.selectedScenario.description:s.$t("try-combos")))])])]):s._e(),e("h3",{staticClass:"center-area sticky"},[e("b",[s._v(s._s(s.$t("estimated-risk"))+": "),e("span",{staticClass:"greenbig",style:{fontSize:"2.5rem",fontWeight:"bold",color:"#596"}},[s._v(s._s(s.adjustedR.toFixed(1))+"%")])])]),s.yaml.multipliers?e("div",{staticClass:"center-area"},[e("div",{staticClass:"option-groups"},[s._l(s.multipliers,function(i){return e("div",{key:`add+${i}`,staticClass:"option-group"},[e("h4",[s._v(s._s(i))]),e("div",{staticClass:"description"},[s._v(s._s(s.yaml.multipliers[i].description))]),e("vue-slider",{staticClass:"slider",attrs:{data:s.lookup[i],"data-value":"value","data-label":"title",tooltip:"none",adsorb:!0,dotSize:20},on:{change:function(a){return s.handleFactorButton(i)}},model:{value:s.sliders[i],callback:function(a){s.$set(s.sliders,i,a)},expression:"sliders[group]"}}),e("p",{staticClass:"slider-label"},[s._v(s._s(s.sliders[i].title))])],1)}),s._l(s.divisors,function(i){return e("div",{key:i,staticClass:"option-group"},[e("h4",[s._v(s._s(i))]),e("div",{staticClass:"description"},[s._v(s._s(s.yaml.divisors[i].description))]),e("vue-slider",{staticClass:"slider",attrs:{data:s.lookup[i],"data-value":"value","data-label":"title",tooltip:"none",adsorb:!0,dotSize:20},on:{change:function(a){return s.handleDivFactorButton(i)}},model:{value:s.sliders[i],callback:function(a){s.$set(s.sliders,i,a)},expression:"sliders[group]"}}),e("p",{staticClass:"slider-label"},[s._v(s._s(s.sliders[i].title))])],1)}),e("br"),s.yaml.notes?e("h3",[e("b",[s._v(s._s(s.$t("remarks"))+":")])]):s._e(),s.yaml.notes?e("ul",s._l(s.yaml.notes,function(i){return e("li",{staticClass:"notes-item",domProps:{innerHTML:s._s(s.parseMarkdown(i))}})}),0):s._e()],2)]):s._e()])},_=[function(){var t=this,s=t._self._c;return t._self._setupProxy,s("div",{staticClass:"banner"},[s("h2",[t._v("VSP / Technische Universität Berlin")]),s("h3",[t._v("COVID-19 Analysis Portal")])])}],k=u(f,v,_,!1,null,"16fe291f");const C=k.exports;export{C as default};
//# sourceMappingURL=RiskCalculator-CEtYJoof.js.map
